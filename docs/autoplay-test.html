<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AudioNews.uk - Autoplay Test Page</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            background: #f5f5f5;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 4px solid #2196f3;
        }
        .log {
            background: #000;
            color: #00ff00;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        button {
            background: #2196f3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success { background: #e8f5e8; border: 1px solid #4caf50; color: #2e7d32; }
        .error { background: #ffebee; border: 1px solid #f44336; color: #c62828; }
        .warning { background: #fff3e0; border: 1px solid #ff9800; color: #e65100; }
    </style>
</head>
<body>
    <h1>üéµ AudioNews.uk - Autoplay Debug Tool</h1>
    
    <div class="test-section">
        <h2>üîç Browser Information</h2>
        <div id="browser-info"></div>
    </div>
    
    <div class="test-section">
        <h2>üéß Audio Player</h2>
        <audio id="test-audio" controls preload="auto" style="width: 100%;">
            <source src="audio/news_digest_ai_2025_10_15.mp3" type="audio/mpeg">
            Your browser doesn't support audio playback.
        </audio>
        <p><strong>URL to test:</strong> <code id="autoplay-url"></code></p>
    </div>
    
    <div class="test-section">
        <h2>üß™ Autoplay Tests</h2>
        <button onclick="testAutoplay()">Test Autoplay</button>
        <button onclick="testWithUserGesture()">Test After User Gesture</button>
        <button onclick="clearLog()">Clear Log</button>
        <div id="status"></div>
        <div class="log" id="log"></div>
    </div>
    
    <div class="test-section">
        <h2>üìã Instructions for Testing</h2>
        <ol>
            <li><strong>Direct test:</strong> Click "Test Autoplay" to see if autoplay works</li>
            <li><strong>URL test:</strong> Copy the URL above and open in new tab</li>
            <li><strong>Share test:</strong> Send the URL to someone via WhatsApp/email</li>
            <li><strong>Browser comparison:</strong> Test in Safari, Chrome, Firefox</li>
        </ol>
        
        <h3>üçé Safari Specific Issues:</h3>
        <ul>
            <li>Requires user interaction for autoplay</li>
            <li>May need audio to be muted first</li>
            <li>Check Safari preferences for autoplay settings</li>
        </ul>
        
        <h3>üîß Chrome Issues:</h3>
        <ul>
            <li>Autoplay policy changed in Chrome 66+</li>
            <li>Requires Media Engagement Index (MEI)</li>
            <li>Check chrome://settings/content/sound</li>
        </ul>
    </div>

    <script>
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            displayBrowserInfo();
            setupAutoplayUrl();
            checkUrlParameters();
        });
        
        function log(message) {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.textContent += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(message);
        }
        
        function setStatus(type, message) {
            const statusElement = document.getElementById('status');
            statusElement.className = `status ${type}`;
            statusElement.textContent = message;
        }
        
        function displayBrowserInfo() {
            const info = {
                'User Agent': navigator.userAgent,
                'Platform': navigator.platform,
                'Language': navigator.language,
                'Cookies Enabled': navigator.cookieEnabled,
                'Online': navigator.onLine,
                'Protocol': window.location.protocol,
                'Host': window.location.host
            };
            
            let html = '<table style="width: 100%; font-size: 12px;">';
            for (const [key, value] of Object.entries(info)) {
                html += `<tr><td style="font-weight: bold; padding: 4px;">${key}:</td><td style="padding: 4px;">${value}</td></tr>`;
            }
            html += '</table>';
            
            document.getElementById('browser-info').innerHTML = html;
        }
        
        function setupAutoplayUrl() {
            const currentUrl = new URL(window.location.href);
            currentUrl.searchParams.set('autoplay', 'true');
            document.getElementById('autoplay-url').textContent = currentUrl.toString();
        }
        
        function checkUrlParameters() {
            const urlParams = new URLSearchParams(window.location.search);
            const autoplay = urlParams.get('autoplay');
            
            if (autoplay === 'true') {
                log('üéµ Autoplay parameter detected in URL');
                setStatus('warning', 'Autoplay requested via URL - testing...');
                setTimeout(testAutoplay, 1000);
            }
        }
        
        function testAutoplay() {
            const audio = document.getElementById('test-audio');
            
            log('üîç Starting autoplay test...');
            log(`üìä Audio readyState: ${audio.readyState}`);
            log(`üìä Audio paused: ${audio.paused}`);
            log(`üìä Audio currentTime: ${audio.currentTime}`);
            log(`üìä Audio duration: ${audio.duration}`);
            
            const playPromise = audio.play();
            
            if (playPromise !== undefined) {
                playPromise.then(function() {
                    log('‚úÖ Autoplay SUCCESS!');
                    setStatus('success', '‚úÖ Autoplay worked! Audio is playing.');
                }).catch(function(error) {
                    log(`‚ùå Autoplay BLOCKED: ${error.name} - ${error.message}`);
                    setStatus('error', `‚ùå Autoplay blocked: ${error.name}`);
                    
                    // Additional debugging
                    if (error.name === 'NotAllowedError') {
                        log('üí° NotAllowedError usually means user interaction required');
                    } else if (error.name === 'AbortError') {
                        log('üí° AbortError usually means audio loading failed');
                    }
                });
            } else {
                log('‚ö†Ô∏è Play method did not return a promise (legacy browser)');
                setStatus('warning', '‚ö†Ô∏è Legacy browser detected');
            }
        }
        
        function testWithUserGesture() {
            log('üëÜ Testing autoplay after user gesture...');
            testAutoplay();
        }
        
        function clearLog() {
            document.getElementById('log').textContent = '';
            document.getElementById('status').textContent = '';
        }
        
        // Additional event listeners for debugging
        const audio = document.getElementById('test-audio');
        
        audio.addEventListener('loadstart', () => log('üì° Audio: loadstart'));
        audio.addEventListener('loadedmetadata', () => log('üìä Audio: loadedmetadata'));
        audio.addEventListener('loadeddata', () => log('üìä Audio: loadeddata'));
        audio.addEventListener('canplay', () => log('‚ñ∂Ô∏è Audio: canplay'));
        audio.addEventListener('canplaythrough', () => log('‚ñ∂Ô∏è Audio: canplaythrough'));
        audio.addEventListener('play', () => log('üéµ Audio: play event'));
        audio.addEventListener('pause', () => log('‚è∏Ô∏è Audio: pause event'));
        audio.addEventListener('ended', () => log('üèÅ Audio: ended'));
        audio.addEventListener('error', (e) => log(`‚ùå Audio error: ${e.message}`));
    </script>
</body>
</html>
